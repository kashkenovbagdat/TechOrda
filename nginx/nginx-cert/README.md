# nginx-cert

<img src="https.jpg" alt="https" width="500"/>

–ö–∞–∫ DevOps'–µ—Ä—É, –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ nginx —Å–µ—Ä–≤–µ—Ä.

–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–±–µ–∑–æ–ø–∞—Å–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –≤–∞—à–µ–º—É —Å–∞–π—Ç—É. –ë–µ–∑ –Ω–µ–≥–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ
–ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –≤–∞—à —Ç—Ä–∞—Ñ–∏–∫ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º.

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ –Ω–µ –º–æ–≥ —É–∑–Ω–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–∏, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —à–∏—Ñ—Ä—É–µ—Ç—Å—è
—Å –ø–æ–º–æ—â—å—é SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤. –ò –∫–æ–≥–¥–∞ –≤–∞—à —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å SSL —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º, —Ç–æ –Ω–∞–∑—ã–≤–∞—é—Ç
—Ç–∞–∫–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª HTTP**S**, –≥–¥–µ "S" - –æ–∑–Ω–∞—á–∞–µ—Ç "Secure" (—Ä—É—Å. "–±–µ–∑–æ–ø–∞—Å–Ω—ã–π").

–ö —Ç–æ–º—É –∂–µ, –∫ HTTPS —Å–∞–π—Ç–∞–º —Ç–∞–∫–∏–µ –ø–æ–∏—Å–∫–æ–≤–∏–∫–∏ –∫–∞–∫ Google –æ—Ç–Ω–æ—Å—è—Ç—Å—è –ª—É—á—à–µ. –¢–∞–∫–∏–µ
—Å–∞–π—Ç—ã –≤—ã—à–µ –¥—Ä—É–≥–∏—Ö –≤ –≤—ã–¥–∞—á–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ, –≤–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ nginx `server` –±–ª–æ–∫.

### –ü–æ–ª–µ–∑–Ω–æ–µ

- [Configuring HTTPS servers](http://nginx.org/en/docs/http/configuring_https_servers.html)
- [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç HTTPS ...–≤ –∫–æ–º–∏–∫—Å–∞—Ö! üåà üéâ üçï](https://howhttps.works/ru/)
- [Nginx –∏ https. –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞—Å—Å –ê+](https://habr.com/ru/post/252821/)

### –ó–∞–¥–∞–Ω–∏–µ

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `server` –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç 443 –ø–æ—Ä—Ç.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `server_name` —Ä–∞–≤–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—é `jusan.kz`.
3. –î–æ–±–∞–≤—å—Ç–µ `location /secret_word` –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É `jusan-nginx-cert` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `201`.
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á. –§–∞–π–ª—ã –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∏–∂–µ:
   - [track-devops.crt](https://stepik.org/media/attachments/lesson/686238/track-devops.crt)
   - [track-devops.key](https://stepik.org/media/attachments/lesson/686238/track-devops.key)
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `ssl_dhparam`.

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
curl -H "Host: jusan.kz" -k https://localhost/secret_word
```

–§–ª–∞–≥ `-k` –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã `curl` –Ω–µ —Ä—É–≥–∞–ª—Å—è –Ω–∞ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.

---
–æ—Ç–≤–µ—Ç 

 curl -H "Host: jusan.kz" -k https://localhost/secret_word
jusan-nginx-certroot@devops:/etc/ssl#



–≤–æ—Ç –∫–æ–Ω—Ñ–∏–≥ 
server {
    listen 443 ssl;
    server_name jusan.kz;

    # –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É
    ssl_certificate /etc/ssl/certs/track-devops.crt;  # –ü—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É
    ssl_certificate_key /etc/ssl/private/track-devops.key;  # –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É
    ssl_dhparam /etc/ssl/private/ssl_dhparam.pem;  # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É dhparam

    location /secret_word {
        return 201 "jusan-nginx-cert";  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –∫–æ–¥–æ–º 201
    }
}

# HTTP redirect to HTTPS
server {
    listen 80;
    server_name jusan.kz;

    return 301 https://$host$request_uri;  # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ HTTPS
}


